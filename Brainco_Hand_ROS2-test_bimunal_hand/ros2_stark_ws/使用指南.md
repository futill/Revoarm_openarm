# Vision Pro æ‰‹åŠ¿æ§åˆ¶çµå·§æ‰‹ - å®Œæ•´ä½¿ç”¨æŒ‡å—

## âœ… å·²åˆ›å»ºçš„æ–‡ä»¶

```
ros2_stark_ws/
â”œâ”€â”€ hand_control_bridge.py     âœ“ æ¡¥æ¥èŠ‚ç‚¹ä¸»ç¨‹åº
â”œâ”€â”€ start_bridge.sh             âœ“ æ¡¥æ¥èŠ‚ç‚¹å¯åŠ¨è„šæœ¬  
â”œâ”€â”€ test_hand_control.py        âœ“ æµ‹è¯•è„šæœ¬ä¸»ç¨‹åº
â”œâ”€â”€ run_test.sh                 âœ“ æµ‹è¯•è„šæœ¬å¯åŠ¨å™¨
â”œâ”€â”€ HAND_CONTROL_README.md      âœ“ è¯¦ç»†ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ QUICK_START.txt             âœ“ å¿«é€Ÿå‚è€ƒå¡ç‰‡
â””â”€â”€ ä½¿ç”¨æŒ‡å—.md                 âœ“ æœ¬æ–‡ä»¶
```

æ‰€æœ‰è„šæœ¬éƒ½å·²æ·»åŠ å¯æ‰§è¡Œæƒé™ï¼ˆchmod +xï¼‰ã€‚

---

## ğŸš€ ä¸‰æ­¥å¯åŠ¨æµç¨‹

### ç¬¬ 1 æ­¥ï¼šå¯åŠ¨ç¡¬ä»¶æ§åˆ¶èŠ‚ç‚¹

**ç»ˆç«¯ 1** è¿è¡Œï¼š
```bash
cd /home/scy/stark-serialport-example/ros2_stark_ws
./stark_serial_manager.sh launch
```

**é¢„æœŸè¾“å‡ºï¼š**
```
Launching left hand node (stark_node_left)...
Launching right hand node (stark_node_right)...
Both nodes are running. Press Ctrl+C to stop.
```

**åŠŸèƒ½ï¼š**
- å¯åŠ¨å·¦æ‰‹æ§åˆ¶èŠ‚ç‚¹ï¼ˆslave_id=126, /dev/ttyUSB0ï¼‰
- å¯åŠ¨å³æ‰‹æ§åˆ¶èŠ‚ç‚¹ï¼ˆslave_id=127, /dev/ttyUSB1ï¼‰
- åˆ›å»ºç¡¬ä»¶æ§åˆ¶è¯é¢˜ï¼š
  - `/set_motor_multi_126` (å·¦æ‰‹)
  - `/set_motor_multi_127` (å³æ‰‹)

---

### ç¬¬ 2 æ­¥ï¼šå¯åŠ¨æ¡¥æ¥èŠ‚ç‚¹

**ç»ˆç«¯ 2** è¿è¡Œï¼š
```bash
cd /home/scy/stark-serialport-example/ros2_stark_ws
./start_bridge.sh
```

**é¢„æœŸè¾“å‡ºï¼š**
```
Hand Control Bridge Node Started
Left hand:  Subscribe /left_hand/motor_commands  â†’ Publish /set_motor_multi_126
Right hand: Subscribe /right_hand/motor_commands â†’ Publish /set_motor_multi_127
Waiting for commands from Vision Pro...
Stats: Left=0 msgs, Right=0 msgs
```

**åŠŸèƒ½ï¼š**
- è®¢é˜… Vision Pro å‘å¸ƒçš„è¯é¢˜ï¼š
  - `/left_hand/motor_commands`
  - `/right_hand/motor_commands`
- è‡ªåŠ¨è½¬å‘åˆ°ç¡¬ä»¶æ§åˆ¶è¯é¢˜
- æ¯ 2 ç§’æ‰“å°ç»Ÿè®¡ä¿¡æ¯

---

### ç¬¬ 3 æ­¥ï¼šè¿è¡Œ Vision Pro æ§åˆ¶è„šæœ¬

**ç»ˆç«¯ 3** è¿è¡Œä½ çš„ Vision Pro è„šæœ¬ï¼š

```bash
cd /home/scy/stark-serialport-example/ros2_stark_ws
source /opt/ros/humble/setup.bash
source install/setup.bash
export ROS_DOMAIN_ID=5
python3 your_visionpro_script.py
```

**åŠŸèƒ½ï¼š**
- ä» Vision Pro è·å–æ‰‹åŠ¿æ•°æ®
- è¿›è¡Œ retargeting è®¡ç®—
- å‘å¸ƒåˆ° `/left_hand/motor_commands` å’Œ `/right_hand/motor_commands`
- æ¡¥æ¥èŠ‚ç‚¹ä¼šè‡ªåŠ¨è½¬å‘åˆ°ç¡¬ä»¶

ç°åœ¨ä½ çš„æ‰‹åŠ¿åº”è¯¥èƒ½å®æ—¶æ§åˆ¶çµå·§æ‰‹äº†ï¼

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³• 1ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆæ¨èï¼‰

åœ¨å¯åŠ¨å‰ä¸¤æ­¥åï¼Œåœ¨**ç»ˆç«¯ 3** è¿è¡Œï¼š

```bash
cd /home/scy/stark-serialport-example/ros2_stark_ws
./run_test.sh
```

**æµ‹è¯•å†…å®¹ï¼š**
1. âœ“ å¼ å¼€åŒæ‰‹
2. âœ“ æ¡æ‹³
3. âœ“ å†æ¬¡å¼ å¼€
4. âœ“ é£ŸæŒ‡å•ç‹¬æµ‹è¯•
5. âœ“ ä¸­æŒ‡å•ç‹¬æµ‹è¯•
6. âœ“ æ— åæŒ‡å•ç‹¬æµ‹è¯•
7. âœ“ å°æŒ‡å•ç‹¬æµ‹è¯•
8. âœ“ æ‹‡æŒ‡æµ‹è¯•
9. âœ“ å¹³æ»‘é—­åˆåŠ¨ä½œ
10. âœ“ å¹³æ»‘å¼ å¼€åŠ¨ä½œ

æ•´ä¸ªæµ‹è¯•å¤§çº¦éœ€è¦ 30 ç§’ã€‚

---

### æ–¹æ³• 2ï¼šæ‰‹åŠ¨å‘½ä»¤æµ‹è¯•

```bash
# è®¾ç½® ROS_DOMAIN_ID
export ROS_DOMAIN_ID=5

# å·¦æ‰‹æ¡æ‹³
ros2 topic pub --once /left_hand/motor_commands \
  ros2_stark_msgs/msg/SetMotorMulti \
  '{mode: 1, positions: [300, 300, 1000, 1000, 1000, 1000]}'

# å·¦æ‰‹å¼ å¼€
ros2 topic pub --once /left_hand/motor_commands \
  ros2_stark_msgs/msg/SetMotorMulti \
  '{mode: 1, positions: [400, 400, 0, 0, 0, 0]}'

# å³æ‰‹æ¡æ‹³
ros2 topic pub --once /right_hand/motor_commands \
  ros2_stark_msgs/msg/SetMotorMulti \
  '{mode: 1, positions: [300, 300, 1000, 1000, 1000, 1000]}'

# å³æ‰‹å¼ å¼€
ros2 topic pub --once /right_hand/motor_commands \
  ros2_stark_msgs/msg/SetMotorMulti \
  '{mode: 1, positions: [400, 400, 0, 0, 0, 0]}'
```

---

## ğŸ” è°ƒè¯•å‘½ä»¤

### æŸ¥çœ‹æ‰€æœ‰ ROS2 è¯é¢˜
```bash
export ROS_DOMAIN_ID=5
ros2 topic list
```

åº”è¯¥çœ‹åˆ°ï¼š
- `/left_hand/motor_commands`
- `/right_hand/motor_commands`
- `/set_motor_multi_126`
- `/set_motor_multi_127`

### ç›‘æ§è¯é¢˜æ•°æ®

```bash
# ç›‘æ§ Vision Pro å‘å¸ƒçš„å‘½ä»¤
ros2 topic echo /left_hand/motor_commands

# ç›‘æ§å‘é€åˆ°ç¡¬ä»¶çš„å‘½ä»¤
ros2 topic echo /set_motor_multi_126

# æŸ¥çœ‹è¯é¢˜å‘å¸ƒé¢‘ç‡
ros2 topic hz /left_hand/motor_commands
```

### æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰æ´»åŠ¨èŠ‚ç‚¹
ros2 node list

# æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯
ros2 node info /hand_control_bridge
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
- **ROS_DOMAIN_ID**: å¿…é¡»ä¸º `5`ï¼ˆæ‰€æœ‰ç»ˆç«¯ä¸€è‡´ï¼‰

### ç¡¬ä»¶é…ç½®
| æ‰‹ | Slave ID | ä¸²å£ | ç¡¬ä»¶è¯é¢˜ |
|---|---------|------|----------|
| å·¦æ‰‹ | 126 (0x7e) | /dev/ttyUSB0 | /set_motor_multi_126 |
| å³æ‰‹ | 127 (0x7f) | /dev/ttyUSB1 | /set_motor_multi_127 |

### ä½ç½®å‚æ•°èŒƒå›´
- **èŒƒå›´**: [0, 1000]
- **0**: å®Œå…¨å¼ å¼€
- **1000**: å®Œå…¨å¼¯æ›²

### ç”µæœºç´¢å¼•
```
positions[0] = æ‹‡æŒ‡å†…æ”¶/å¤–å±• (thumb adduct)
positions[1] = æ‹‡æŒ‡å¼¯æ›² (thumb flex)
positions[2] = é£ŸæŒ‡å¼¯æ›² (index flex)
positions[3] = ä¸­æŒ‡å¼¯æ›² (middle flex)
positions[4] = æ— åæŒ‡å¼¯æ›² (ring flex)
positions[5] = å°æŒ‡å¼¯æ›² (pinky flex)
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: `ModuleNotFoundError: No module named 'ros2_stark_msgs'`

**åŸå› **: æ²¡æœ‰æ­£ç¡®è®¾ç½® ROS2 ç¯å¢ƒ

**è§£å†³**: ä½¿ç”¨æä¾›çš„å¯åŠ¨è„šæœ¬
```bash
./run_test.sh        # æµ‹è¯•è„šæœ¬
./start_bridge.sh    # æ¡¥æ¥èŠ‚ç‚¹
```

æˆ–æ‰‹åŠ¨è®¾ç½®ç¯å¢ƒï¼š
```bash
source /opt/ros/humble/setup.bash
source install/setup.bash
export ROS_DOMAIN_ID=5
```

---

### é—®é¢˜ 2: ä¸²å£æƒé™ä¸è¶³

**é”™è¯¯**: `Permission denied: '/dev/ttyUSB0'`

**è§£å†³æ–¹æ¡ˆ A** (ä¸´æ—¶):
```bash
sudo chmod 666 /dev/ttyUSB0
sudo chmod 666 /dev/ttyUSB1
```

**è§£å†³æ–¹æ¡ˆ B** (æ°¸ä¹…):
```bash
sudo usermod -aG dialout $USER
# éœ€è¦é‡æ–°ç™»å½•
```

---

### é—®é¢˜ 3: æ¡¥æ¥èŠ‚ç‚¹æ”¶ä¸åˆ° Vision Pro æ•°æ®

**æ£€æŸ¥æ¸…å•**:
1. âœ“ æ‰€æœ‰ç»ˆç«¯çš„ `ROS_DOMAIN_ID` éƒ½æ˜¯ 5
2. âœ“ Vision Pro è„šæœ¬æ­£å¸¸è¿è¡Œ
3. âœ“ ä½¿ç”¨ `ros2 topic list` æ£€æŸ¥è¯é¢˜å­˜åœ¨
4. âœ“ ä½¿ç”¨ `ros2 topic echo` æ£€æŸ¥æ•°æ®æµ

**éªŒè¯æ•°æ®æµ**:
```bash
# åœ¨ Vision Pro è„šæœ¬è¿è¡Œæ—¶
ros2 topic echo /left_hand/motor_commands
# åº”è¯¥èƒ½çœ‹åˆ°æŒç»­çš„æ•°æ®æµ
```

---

### é—®é¢˜ 4: çµå·§æ‰‹ä¸åŠ¨

**æ£€æŸ¥æ¸…å•**:
1. âœ“ `stark_serial_manager.sh launch` æ­£å¸¸è¿è¡Œ
2. âœ“ ä¸²å£è®¾å¤‡å­˜åœ¨ï¼š`ls -l /dev/ttyUSB*`
3. âœ“ ä¸²å£æƒé™æ­£ç¡®
4. âœ“ ç¡¬ä»¶ä¾›ç”µæ­£å¸¸
5. âœ“ ä½¿ç”¨æµ‹è¯•è„šæœ¬éªŒè¯åŸºæœ¬åŠŸèƒ½

**æµ‹è¯•ç¡¬ä»¶è¿æ¥**:
```bash
./run_test.sh
# å¦‚æœæµ‹è¯•é€šè¿‡ï¼Œè¯´æ˜ç¡¬ä»¶è¿æ¥æ­£å¸¸
```

---

### é—®é¢˜ 5: è¯é¢˜æ— æ³•è¿æ¥

**æ£€æŸ¥ ROS_DOMAIN_ID**:
```bash
# åœ¨æ¯ä¸ªç»ˆç«¯æ£€æŸ¥
echo $ROS_DOMAIN_ID
# åº”è¯¥éƒ½æ˜¾ç¤º 5
```

**é‡æ–°è®¾ç½®**:
```bash
export ROS_DOMAIN_ID=5
```

---

## ğŸ“Š æ•°æ®æµæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Vision Pro        â”‚
â”‚  (æ‰‹åŠ¿æ•æ‰)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ å‘å¸ƒ
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /left_hand/motor_   â”‚
â”‚      commands       â”‚
â”‚ /right_hand/motor_  â”‚
â”‚      commands       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ è®¢é˜…
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hand Control Bridge â”‚
â”‚   (æ¡¥æ¥èŠ‚ç‚¹)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ è½¬å‘
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /set_motor_multi_126â”‚
â”‚ /set_motor_multi_127â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ è®¢é˜…
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stark Node (L/R)   â”‚
â”‚  (ç¡¬ä»¶æ§åˆ¶èŠ‚ç‚¹)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ RS-485
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    çµå·§æ‰‹ç¡¬ä»¶       â”‚
â”‚  (å·¦æ‰‹ 126/å³æ‰‹ 127)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### å‡å°‘æ—¥å¿—è¾“å‡º

å¦‚æœç»ˆç«¯è¾“å‡ºå¤ªå¤šï¼Œå¯ä»¥ç¼–è¾‘ `hand_control_bridge.py`ï¼š

```python
# ç¬¬ 71-74 è¡Œï¼Œä¿®æ”¹æ‰“å°é¢‘ç‡
if self.left_count % 50 == 0:  # ä» 10 æ”¹ä¸º 50
    self.get_logger().debug(...)

# ç¬¬ 97-100 è¡Œï¼Œä¿®æ”¹æ‰“å°é¢‘ç‡  
if self.right_count % 50 == 0:  # ä» 10 æ”¹ä¸º 50
    self.get_logger().debug(...)
```

### è°ƒæ•´ç»Ÿè®¡ä¿¡æ¯é¢‘ç‡

```python
# ç¬¬ 56 è¡Œ
self.stats_timer = self.create_timer(5.0, self.print_statistics)  # ä» 2.0 æ”¹ä¸º 5.0
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **QUICK_START.txt**: å¿«é€Ÿå¯åŠ¨å‚è€ƒå¡ç‰‡
- **HAND_CONTROL_README.md**: è¯¦ç»†æŠ€æœ¯æ–‡æ¡£
- **æœ¬æ–‡ä»¶ (ä½¿ç”¨æŒ‡å—.md)**: å®Œæ•´ä½¿ç”¨æµç¨‹

---

## ğŸ¯ å¿«é€Ÿå‘½ä»¤é€ŸæŸ¥

```bash
# å¯åŠ¨ç¡¬ä»¶æ§åˆ¶
./stark_serial_manager.sh launch

# å¯åŠ¨æ¡¥æ¥èŠ‚ç‚¹
./start_bridge.sh

# è¿è¡Œæµ‹è¯•
./run_test.sh

# æŸ¥çœ‹è¯é¢˜
ros2 topic list

# ç›‘æ§æ•°æ®
ros2 topic echo /left_hand/motor_commands

# æ£€æŸ¥æƒé™
ls -l /dev/ttyUSB*

# ä¿®å¤æƒé™
sudo chmod 666 /dev/ttyUSB*
```

---

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

1. **å»ºè®®ä½¿ç”¨ tmux æˆ– screen** ç®¡ç†å¤šä¸ªç»ˆç«¯
2. **æµ‹è¯•å‰å…ˆè¿è¡Œ `./run_test.sh`** ç¡®ä¿ç¡¬ä»¶æ­£å¸¸
3. **è§‚å¯Ÿæ¡¥æ¥èŠ‚ç‚¹çš„ç»Ÿè®¡ä¿¡æ¯** åˆ¤æ–­æ•°æ®æµæ˜¯å¦æ­£å¸¸
4. **Vision Pro è„šæœ¬çš„ä½ç½®æ˜ å°„** å·²ç»è¿‡æ ¡å‡†ï¼Œç›´æ¥ä½¿ç”¨å³å¯
5. **å¦‚éœ€è°ƒæ•´æ‰‹åŠ¿æ˜ å°„**ï¼Œä¿®æ”¹ Vision Pro è„šæœ¬ä¸­çš„ retargeting å‚æ•°

---

## âœ¨ æ€»ç»“

ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ Vision Pro æ‰‹åŠ¿æ§åˆ¶ç³»ç»Ÿï¼š

âœ… **æ¡¥æ¥èŠ‚ç‚¹**: è‡ªåŠ¨è½¬å‘ Vision Pro å‘½ä»¤åˆ°ç¡¬ä»¶  
âœ… **æµ‹è¯•å·¥å…·**: å®Œæ•´çš„è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬  
âœ… **å¯åŠ¨è„šæœ¬**: ä¸€é”®å¯åŠ¨ï¼Œè‡ªåŠ¨é…ç½®ç¯å¢ƒ  
âœ… **å®Œæ•´æ–‡æ¡£**: ä½¿ç”¨è¯´æ˜ã€è°ƒè¯•æŒ‡å—ã€æ•…éšœæ’æŸ¥  

äº«å—ä½ çš„æ‰‹åŠ¿æ§åˆ¶çµå·§æ‰‹ä½“éªŒï¼ğŸ‰

